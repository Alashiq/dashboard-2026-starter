<div class="w-auto md:p-8 p-4" id="0" @click="openOptions($event)">
    <!-- List Header -->
    <div class="flex justify-between w-full h-16 items-center">
        <div class="text-2xl font-semibold cairo text-gray-600">قائمة المنتجات</div>
        <!-- تم تغيير الصلاحية والرابط -->
        <router-link v-show="$parent.$parent.checkPermission('CreateProduct') == true" to="/admin/product/new"
            class="rounded px-4 flex items-center cairo font-medium add-btn">
            <span class="h-12 flex items-center">
                <i class="fas fa-plus text-lg"></i>
                <div class="w-3"></div>
                <!-- تم تغيير النص -->
                <p class=" md:block hidden text-base JF-Flat">أضف منتج</p>
            </span>
        </router-link>
    </div>

    <!-- Search -->
    <div class="flex flex-wrap pb-5 px-4 bg-white border rounded mt-4">
        <div class="xl:w-1/4 lg:w-1/3 md:w-1/2 w-full px-2 mt-4">
            <div class="text-gray-400 text-sm cairo h-8 flex items-center mr-2">اسم المنتج</div>
            <input type="text" v-model="nameSrh" placeholder="ابحث باسم المنتج..."
                class="w-full h-12 border border-gray-300 rounded outline-green-600 cairo placeholder:text-sm px-4">
        </div>
        <div class="xl:w-1/4 lg:w-1/3 md:w-1/2 px-2 mt-4 flex items-center justify-center">
            <div class="h-10 mt-8 shadow rounded w-28 add-btn flex items-center justify-center text-white cairo"
                @click="loadData(1)">بحث</div>
            <div class="w-3"></div>
            <div class="h-10 mt-8 shadow-lg rounded w-24 bg-gray-400 text-white cairo flex items-center justify-center"
                @click="clearSearch()">تصفير</div>
        </div>
    </div>

    <div v-if="loaded==200">
        <table class="w-full mt-4">
            <tr class="h-12 text-lg cairo font-semibold text-gray-600">
                <td class="w-12 text-center">#</td>
                <td>الصورة</td>
                <td>اسم المنتج</td>
                <td>متعهد التموين</td> <!-- عمود جديد -->
                <td>الحالة</td>
                <td class="rounded-l-lg">الإجراءات</td>
            </tr>
            <!-- تم تغيير `mainList` ليعرض بيانات المنتجات -->
            <tr v-for="(item, index) in mainList" :key="index"
                class="h-24 bg-white shadow-2 rounded-lg text-base JF-Flat text-gray-500 font-medium hover:bg-gray-50">
                <td class="w-12 text-center rounded-r-lg">{{ item.id }}</td>
                <td>
                    <img v-if="item.photo" :src="item.photo" class="w-16 h-16 object-cover rounded-lg">
                    <span v-else class="text-xs text-gray-400">لا توجد صورة</span>
                </td>
                <td>{{ item.name }}</td>
                <td>
                    <!-- التحقق الشرطي: عرض اسم متعهد التموين فقط إذا كان موجودًا -->
                    <span v-if="item.caterer" class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm">
                        {{ item.caterer.name }}
                    </span>
                    <span v-else class="text-xs text-gray-400">منتج عام</span>
                </td>
                <td>
                    <span v-if="item.status==1" class="text-green-600">نشط</span>
                    <span v-else class="text-red-600">غير نشط</span>
                </td>
                <td class="h-20 flex items-center justify-center rounded-l-lg">
                    <div class="flex items-start justify-center mx-auto">
                        <i class="fas fa-ellipsis-v text-gray-500 text-xl w-8 flex pt-2 justify-center"
                            @click="openOptions($event)" :id="item.id"></i>
                        <div v-if="item.id==optionId"
                            class="py-2 px-2 w-36 bg-white rounded-lg absolute text-gray-600 text-sm cairo"
                            style="box-shadow: rgb(145 158 171 / 24%) 0px 0px 2px 0px, rgb(145 158 171 / 24%) -20px 20px 40px -4px;">
                            <!-- تم تغيير الروابط والصلاحيات -->
                            <router-link :to="'/admin/product/' + item.id">
                                <div class="h-8 w-auto px-2 rounded-lg hover:bg-gray-100 flex items-center">
                                    <i class="fas fa-eye"></i>
                                    <div class="mr-2">عرض</div>
                                </div>
                            </router-link>
                            <router-link :to="'/admin/product/' + item.id + '/edit'"
                                v-show="$parent.$parent.checkPermission('EditProduct') == true">
                                <div class="h-8 w-auto px-2 rounded-lg hover:bg-gray-100 flex items-center">
                                    <i class="fas fa-edit"></i>
                                    <div class="mr-2">تعديل</div>
                                </div>
                            </router-link>
                            <div class="h-px border border-dashed border-gray-200 w-full my-1"></div>
                            <div v-show="$parent.$parent.checkPermission('DeleteProduct') == true"
                                @click="deleteProduct(item.id)"
                                class="h-8 w-auto px-2 rounded-lg hover:bg-gray-100 flex items-center text-red-500">
                                <i class="far fa-trash-alt"></i>
                                <div class="mr-2">حذف</div>
                            </div>
                            <div 
                            v-show="$parent.$parent.checkPermission('ActiveProduct') == true"
                            class="h-8 w-auto px-2 rounded-lg hover:bg-gray-100 flex items-center text-blue-500"
                                v-if="item.status==0" @click="activeProduct(item.id, index)">
                                <i class="fas fa-check"></i>
                                <div class="mr-2">تفعيل</div>
                            </div>
                            <div 
                            v-show="$parent.$parent.checkPermission('DisActiveProduct') == true"
                            class="h-8 w-auto px-2 rounded-lg hover:bg-gray-100 flex items-center text-yellow-500"
                                v-if="item.status==1" @click="disActiveProduct(item.id, index)">
                                <i class="fas fa-ban"></i>
                                <div class="mr-2">إلغاء التفعيل</div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
        </table>

        <!-- Pagination -->
        <Pagination-Bar :itemTo="itemTo" :itemFrom="itemFrom" :totalRows="totalRows" :pageId="pageId"
            :lastPage="lastPage" :moveToNext="moveToNext" :moveToPrevius="moveToPrevius"
            :changePerPage="changePerPage"></Pagination-Bar>
    </div>

    <!-- Components for different states -->
    <Empty-Box v-if="loaded==204"></Empty-Box>
    <Bad-Request v-if="loaded==400" :reload="reload" :message="errorMessage"></Bad-Request>
    <No-Permission v-if="loaded==403" :message="errorMessage"></No-Permission>
    <No-Internet v-if="loaded==404" :reload="reload"></No-Internet>
</div>
